<html lang="en">
<head>
	<link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet">
	<!-- Webpage Title -->
	<title>Hello, world!</title>

	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<!-- JS -->		
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<style type="text/css">
		.mytitle {
			width: 400px;
			font-size: 30px;
			font-weight: bold;
			margin: 10px 0 0 0  }

			.price {

				font-size: 20px;
				font-weight: 100;
			}
			.wrap { 
				margin: 20px 0 0 0;
				width: 400px; }

				.here {

					text-align: center;
					margin: 20px 0 0 0;
				}
				.pr {

					width: 400px;
					margin: 20px auto 0 auto;
				}

				* {
					font-family: 'Stylish', sans-serif;
				}

				.imgbox {

					width: 400px;
					height: 300px;
				}

			</style>
			<script type="text/javascript">
				function order() {
					let name = $('#order_name').val();
					let count = $('#order_count').val();
					let address = $('#order_address').val();
					let phone = $('#order_phone').val();

					if (name == ''){
						alert('이름을 입력해주세요')
						$('#order_name').focus()
						return
					} else if (count == ''){
						alert('수량을 입력해주세요')
						$('#order_count').focus()
						return
					} else if (address == ''){
						alert('주소를 입력해주세요')
						$('#order_address').focus()
						return
					} else if (phone == ''){
						alert('휴대폰번호를 입력해주세요')
						$('#order_phone').focus()
						return
					} else if (!isCellPhone(phone)) {
						alert('휴대폰번호 입력 형식이 틀립니다. \n 010-0000-0000으로 입력해주세요')
						return
					}


				}
				
				$.ajax({
					type: "POST",
					url: "/order",
					data: { name_give:name, count_give:count, address_give:address, phone_give:phone },
					success: function(response){
						if(response['result'] == 'success'){
							alert('주문 완료!');
							window.location.reload();
						}
					}
				})
				

				$(document).ready(function(){
					$('#orders-box').html('');
					listing();
				});

				function listing() {
					$.ajax({
						type: "GET",
						url: "/order",
						data: {},
						success: function(response){
							if (response['result'] == 'success') {
								let orders = response['orders'];
								console.log(orders);
								for (let i = 0; i < orders.length; i++) {
									make_card(orders[i]['name'],orders[i]['count'],orders[i]['address'],orders[i]['phone'])
								}
							} else {
								alert('기사를 받아오지 못했습니다');
							}
						}
					})
				}

				function make_card(name,count,address,phone) {
					let temp_html = '<tr>\
					<td>'+name+'</td>\
					<td>'+count+'</td>\
					<td>'+address+'</td>\
					<td>'+phone+'</td>\
					</tr>';
					$('#orders-box').append(temp_html);
				}
				



			</script>
		</head>
		<body>
			<div class="pr">
				<div class="wrap">

					<img class="imgbox" src="https://image.ohou.se/image/central_crop/bucketplace-v2-development/uploads-productions-1561346841191_2j.jpg/850/850">

					<h1 class="mytitle">양초를 팝니다. <span class="price">가격: 3,000원/개</span>
					</h1>

					<p>이 양초는 사실 특별한 힘을 가지고 있어요. 양초를 켜고 소원을 빌면 짜자잔 뭐든지 이뤄지게 된답니다. 하나 사가세요! 향이 아주 좋아요.</p>

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="inputGroup-sizing-default">주문자 이름</span>
						</div>
						<input id="order_name" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
					</div>

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<label class="input-group-text" for="inputGroupSelect01">수량</label>
						</div>
						<select class="custom-select" id="order_count">
							<option selected>----수량을 선택하세요----</option>
							<option value="1">1개(3,000원)</option>
							<option value="2">2개(5,000원)</option>
							<option value="3">3개(7,000원)</option>
						</select>
					</div>

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="inputGroup-sizing-default">주소</span>
						</div>
						<input id="order_address" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
					</div>

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="inputGroup-sizing-default">전화번호</span>
						</div>
						<input id="order_phone" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
					</div>
					<div class="here">
						<button onclick="order()" type="button" class="btn btn-primary">주문하기</button>
					</div>

				</div>
				<div>

					<table class="table">
						<thead>
							<tr>
								<th scope="col">#</th>
								<th scope="col">First</th>
								<th scope="col">Last</th>
								<th scope="col">Handle</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">1</th>
								<td>Mark</td>
								<td>Otto</td>
								<td>@mdo</td>
							</tr>
							<tr>
								<th scope="row">2</th>
								<td>Jacob</td>
								<td>Thornton</td>
								<td>@fat</td>
							</tr>
							<tr>
								<th scope="row">3</th>
								<td>Larry</td>
								<td>the Bird</td>
								<td>@twitter</td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>
		</body>
		</html>